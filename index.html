<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI3 Demo App - Autonomys Network</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <nav class="top-nav">
                <a href="index.html" class="nav-link active">Home</a>
                <a href="stats.html" class="nav-link">Network Stats</a>
                <a href="explore.html" class="nav-link">Explore Files</a>
            </nav>
            <h1>AI3 Demo Application</h1>
            <p class="subtitle">Autonomys Network (Taurus Testnet)</p>
        </header>

        <div class="top-row">
            <div class="card card-half">
                <h2>Wallet Connection</h2>
                <div id="connection-section">
                    <button id="connectButton" class="btn btn-primary">Connect Wallet</button>
                    <div id="wallet-info" class="hidden">
                        <p><strong>Connected:</strong> <span id="account"></span></p>
                        <p><strong>Balance:</strong> <span id="balance"></span> tAI3</p>
                        <p><strong>Network:</strong> <span id="network"></span></p>
                        <div class="wallet-actions">
                            <a id="explorerLink" href="#" target="_blank" rel="noreferrer" class="btn btn-secondary">View on Explorer</a>
                            <button id="disconnectButton" class="btn btn-secondary">Disconnect</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card card-half">
                <h2>Auto Drive API</h2>
                <div class="form-group">
                    <label for="apiKeyInput">API Key (<a href="https://ai3.storage/" target="_blank">Get one here</a>):</label>
                    <input type="password" id="apiKeyInput" placeholder="Enter your API key" class="input">
                </div>
                <div id="api-status" class="hidden">
                    <p class="api-connected">Connected to Auto Drive</p>
                </div>
            </div>
        </div>

        <div class="card" id="upload-section">
            <h2>File Upload & Sharing</h2>
            <div id="upload-form">
                
                <div id="credits-section" class="hidden">
                    <div class="credits-display">
                        <div class="credits-header">
                            <h3>Storage Credits</h3>
                            <a href="https://ai3.storage/" target="_blank" class="btn btn-small btn-secondary">View Dashboard</a>
                        </div>
                        <div class="credits-bar-container">
                            <div id="credits-bar" class="credits-bar"></div>
                        </div>
                        <div class="credits-stats">
                            <div class="stat">
                                <span class="stat-label">Used:</span>
                                <span id="credits-used" class="stat-value">0</span>
                                <span class="stat-unit">MB</span>
                            </div>
                            <div class="stat">
                                <span class="stat-label">Remaining:</span>
                                <span id="credits-remaining" class="stat-value">100</span>
                                <span class="stat-unit">MB</span>
                            </div>
                            <div class="stat">
                                <span class="stat-label">Total:</span>
                                <span id="credits-total" class="stat-value">100</span>
                                <span class="stat-unit">MB</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="fileInput">Select File:</label>
                    <input type="file" id="fileInput" class="input">
                    <span id="selected-file-size" class="file-size-display"></span>
                </div>
                <button id="uploadButton" class="btn btn-primary">Upload to AI3</button>
                <div id="upload-status" class="hidden"></div>
            </div>
            <div id="upload-success" class="hidden">
                <div class="success-header">
                    <h3>File Uploaded Successfully</h3>
                </div>
                
                <div class="file-record">
                    <div class="record-item">
                        <span class="record-label">Content ID (CID):</span>
                        <span id="fileId" class="monospace record-value"></span>
                        <button id="copyCidButton" class="btn btn-small btn-secondary">Copy</button>
                    </div>
                    <div class="record-item">
                        <span class="record-label">Gateway URL:</span>
                        <span id="shareLink" class="monospace record-value"></span>
                    </div>
                    <div class="record-item">
                        <span class="record-label">File Size:</span>
                        <span id="uploadedFileSize" class="record-value"></span>
                    </div>
                </div>

                <div class="on-chain-info">
                    <h4>On-Chain Record</h4>
                    <p class="info-text">Your file is permanently stored on the Autonomys Distributed Storage Network (DSN). The data is:</p>
                    <ul class="chain-details">
                        <li>Distributed across farmers/nodes on the network</li>
                        <li>Identified by the unique CID above</li>
                        <li>Storage proofs submitted to the consensus layer</li>
                    </ul>
                    <div class="explorer-links">
                        <a id="gatewayLink" href="#" target="_blank" class="btn btn-small btn-primary">View on Gateway</a>
                        <a href="https://ai3.storage/" target="_blank" class="btn btn-small btn-secondary">Auto Drive Dashboard</a>
                        <a href="https://autonomys.subscan.io/" target="_blank" class="btn btn-small btn-secondary">Consensus Explorer</a>
                    </div>
                </div>

                <div id="qr-code-container" class="qr-container"></div>
                <div class="upload-actions">
                    <button id="copyLinkButton" class="btn btn-secondary">Copy Share Link</button>
                    <button id="downloadQRButton" class="btn btn-secondary">Download QR Code</button>
                    <button id="uploadNewButton" class="btn btn-secondary">Upload Another File</button>
                </div>
            </div>
        </div>

        <div class="card" id="my-files-section">
            <h2>My Files</h2>
            <p class="subtitle">Files stored permanently on the Autonomys DSN</p>
            <div id="files-loading" class="hidden">Loading files...</div>
            <div id="files-list" class="hidden">
                <div class="files-info-banner">
                    <p>All files below are stored on-chain with storage proofs on the consensus layer.</p>
                    <a href="https://autonomys.subscan.io/" target="_blank" class="btn btn-small btn-secondary">View Consensus Explorer</a>
                </div>
                <table class="files-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Size / Credits</th>
                            <th>CID (On-Chain ID)</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="files-table-body"></tbody>
                </table>
                <div id="files-pagination" class="pagination"></div>
            </div>
            <div id="files-error" class="hidden error"></div>
        </div>

        <div class="card hidden" id="download-section">
            <h2>Download Shared File</h2>
            <div id="download-content">
                <p id="file-info-text"></p>
                <button id="downloadFileButton" class="btn btn-primary">Download File</button>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
